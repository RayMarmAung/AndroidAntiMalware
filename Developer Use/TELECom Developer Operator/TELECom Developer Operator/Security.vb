Imports System.IO
Imports System.Text
Imports System.Security.Cryptography

Module Security
    Private builder As New StringBuilder
    Public ProductSerialNo As String
    Public RegState As Boolean = False
    Public Enum HashTypeAlgo
        MD5
        SHA1
        SHA256
        SHA384
        SHA512
    End Enum
    Public Function HashString(IN_STRING As String, algo As HashTypeAlgo)

        Dim inStringBytes As Byte() = Nothing
        Dim hashBytes As Byte() = Nothing

        inStringBytes = Encoding.ASCII.GetBytes(IN_STRING)

        Select Case algo
            Case HashTypeAlgo.MD5
                hashBytes = MD5.Create().ComputeHash(inStringBytes)
                Exit Select
            Case HashTypeAlgo.SHA1
                hashBytes = SHA1.Create().ComputeHash(inStringBytes)
                Exit Select
            Case HashTypeAlgo.SHA256
                hashBytes = SHA256.Create().ComputeHash(inStringBytes)
                Exit Select
            Case HashTypeAlgo.SHA384
                hashBytes = SHA384.Create().ComputeHash(inStringBytes)
                Exit Select
            Case HashTypeAlgo.SHA512
                hashBytes = SHA512.Create().ComputeHash(inStringBytes)
                Exit Select
        End Select

        Return MakeHashString(hashBytes)
    End Function
    Private Function MakeHashString(hash As Byte()) As String

        builder.Remove(0, builder.Length)

        For Each b As Byte In hash
            builder.Append(b.ToString("X2").ToUpper())
        Next

        Return builder.ToString()
    End Function
    Public TripleDes As New TripleDESCryptoServiceProvider
    Public Function TruncateHash(key As String, length As Integer) As Byte()

        Dim sha1 As New SHA1CryptoServiceProvider
        Dim KeyBytes() As Byte = Encoding.Unicode.GetBytes(key)
        Dim hash() As Byte = sha1.ComputeHash(KeyBytes)

        ReDim Preserve hash(length - 1)

        Return hash
    End Function
    Public Function EncryptData(str As String) As String
        Dim strBytes() As Byte = Encoding.Unicode.GetBytes(str)
        Dim ms As New MemoryStream
        Dim encStream As New CryptoStream(ms, TripleDes.CreateEncryptor(), CryptoStreamMode.Write)

        encStream.Write(strBytes, 0, strBytes.Length)
        encStream.FlushFinalBlock()

        Return Convert.ToBase64String(ms.ToArray)

    End Function

End Module
