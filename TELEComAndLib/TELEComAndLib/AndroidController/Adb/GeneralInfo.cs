//* *********************************************************************************
//* GeneralInfo.vb Developed by Ray Marm Aung (Ray -Electronics) for TELEComLib.dll *
//* *********************************************************************************

using System.IO;

namespace Telecom.Android
{
    public class GeneralInfo
    {

        #region "Fields"

        private Device _device;
        private string _brand = "Can't be Listed";
        private string _model = "Can't be Listed";

        private string _version = "Can't be Listed";
        #endregion

        #region "Properties"
        public string BrandName
        {
            get
            {
                try
                {
                    _brand = GetpropInfo("[ro.product.brand]", true);
                    _brand = _brand.Substring(0, 1).ToUpper() + _brand.Substring(1).ToLower();
                }
                catch 
                {
                    _brand = "Can't be Listed";
                }
                return _brand;
            }
        }
        public string ModelName
        {
            get
            {
                try
                {
                    _model = GetpropInfo("[ro.product.model]", true);

                    if (_model.ToUpper().Contains(_brand.ToUpper()))
                        _model = _model.ToUpper().Replace(_brand.ToUpper(), "").Replace(" ","");

                }
                catch 
                {
                    _model = "Can't be Listed";
                }

                return _model;
            }
        }
        public string AndroidVersion
        {
            get
            {
                try
                {
                    _version = GetpropInfo("[ro.build.version.release]");

                    if (_version.StartsWith("2"))
                    {
                        _version += " (Gingerbread)";
                    }
                    else if (_version.StartsWith("3"))
                    {
                        _version += " (Honeycomb)";
                    }
                    else if (_version.StartsWith("4.0"))
                    {
                        _version += " (ICS)";
                    }
                    else if (_version.StartsWith("4.1") || _version.StartsWith("4.2") || _version.StartsWith("4.3"))
                    {
                        _version += " (Jelly Bean)";
                    }
                    else if (_version.StartsWith("4.4"))
                    {
                        _version += " (Kitkat)";
                    }
                    else if (_version.StartsWith("5"))
                    {
                        _version += " (Lollipop)";
                    }
                    else if (_version.StartsWith("6"))
                    {
                        _version += " (Marshmallow)";
                    }

                }
                catch 
                {
                    _version = "Can't be Listed";
                }
                   
                return _version;
            }
        }

        #endregion

        #region "Procedures"
        internal GeneralInfo(Device dev)
        {
            _device = dev;
        }
        private string GetpropInfo(string name, bool space = false)
        {

            string result = "Can't be Listed";
            string dump = _device.Info.Getprop;

            using (StringReader r = new StringReader(dump))
            {
                string line = null;

                while (!(r.Peek() == -1))
                {
                    line = r.ReadLine();

                    if (line.Contains(name))
                    {
                        if (space)
                        {
                            result = line.Substring(line.IndexOf(":") + 2).Replace("[", "").Replace("]", "");
                        }
                        else
                        {
                            result = line.Substring(line.IndexOf(":") + 2).Replace(" ", "").Replace("[", "").Replace("]", "");
                        }
                        break; // TODO: might not be correct. Was : Exit While
                    }
                }
            }

            return result;
        }

        #endregion

    }

}
