Imports System.IO
Public Class frmActivation

    Dim drag As Boolean
    Dim mousex As Integer
    Dim mousey As Integer
    Private Sub frmActivation_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        lbSerial.Text = ProductSerialNo
    End Sub

#Region "TEXT BOX"
    Private Sub CheckActivateButton()
        If txtActivation1.TextLength = 4 And txtActivation2.TextLength = 4 And txtActivation3.TextLength = 4 And txtActivation4.TextLength = 4 Then
            butActivate.ForeColor = Color.GreenYellow
        Else
            butActivate.ForeColor = Color.White
        End If
    End Sub
    Private Sub txtActivation1_TextChanged(sender As Object, e As EventArgs) Handles txtActivation1.TextChanged

        If sender.textlength = 4 Then
            txtActivation2.Focus()
        End If

        CheckActivateButton()

    End Sub
    Private Sub txtActivation2_TextChanged(sender As Object, e As EventArgs) Handles txtActivation2.TextChanged

        If sender.textLength = 4 Then
            txtActivation3.Focus()
        ElseIf sender.textLength = 0 Then
            txtActivation1.Focus()
        End If

        CheckActivateButton()

    End Sub
    Private Sub txtActivation2_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtActivation2.KeyPress
        If (sender.textlength = 0 Or sender.textlength = 1) And Asc(e.KeyChar) = 8 Then
            txtActivation1.Focus()
            SendKeys.Send("{BACKSPACE}")
        End If
    End Sub
    Private Sub txtActivation3_TextChanged(sender As Object, e As EventArgs) Handles txtActivation3.TextChanged

        If sender.textLength = 4 Then
            txtActivation4.Focus()
        ElseIf sender.textLength = 0 Then
            txtActivation2.Focus()
        End If

        CheckActivateButton()
    End Sub
    Private Sub txtActivation3_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtActivation3.KeyPress
        If (sender.textlength = 0 Or sender.textlength = 1) And Asc(e.KeyChar) = 8 Then
            txtActivation2.Focus()
            SendKeys.Send("{BACKSPACE}")
        End If
    End Sub
    Private Sub txtActivation4_TextChanged(sender As Object, e As EventArgs) Handles txtActivation4.TextChanged
        If sender.textLength = 4 Then
            butActivate.Focus()
        ElseIf sender.textLength = 0 Then
            txtActivation3.Focus()
        End If

        CheckActivateButton()
    End Sub
    Private Sub txtActivation4_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtActivation4.KeyPress
        If (sender.textlength = 0) And Asc(e.KeyChar) = 8 Then
            txtActivation3.Focus()
            SendKeys.Send("{BACKSPACE}")
        End If
    End Sub
#End Region

#Region "FORM MOVE"
    Private Sub A1Panel2_MouseDown(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseDown, PictureBox3.MouseDown, PictureBox11.MouseDown, Brand.MouseDown, Label8.MouseDown
        drag = True
        mousex = Windows.Forms.Cursor.Position.X - Me.Left
        mousey = Windows.Forms.Cursor.Position.Y - Me.Top
    End Sub
    Private Sub A1Panel2_MouseMove(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseMove, PictureBox3.MouseMove, PictureBox11.MouseMove, Brand.MouseMove, Label8.MouseMove
        If drag Then
            Me.Top = Windows.Forms.Cursor.Position.Y - mousey
            Me.Left = Windows.Forms.Cursor.Position.X - mousex
        End If
    End Sub
    Private Sub A1Panel2_MouseUp(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseUp, PictureBox3.MouseUp, PictureBox11.MouseUp, Brand.MouseUp, Label8.MouseUp
        drag = False
    End Sub

#End Region

#Region "CLOSE BUTTON"
    Private Sub PictureBox8_MouseMove(sender As Object, e As MouseEventArgs) Handles PictureBox8.MouseMove
        PictureBox8.Image = Image.FromStream(New FileStream("Resources\AdbWinC.dll", FileMode.Open, FileAccess.Read))
    End Sub
    Private Sub PictureBox8_MouseLeave(sender As Object, e As EventArgs) Handles PictureBox8.MouseLeave
        PictureBox8.Image = Image.FromStream(New FileStream("Resources\AdbWinD.dll", FileMode.Open, FileAccess.Read))
    End Sub
    Private Sub PictureBox8_Click(sender As Object, e As EventArgs) Handles PictureBox8.Click, CButton2.ClickButtonArea
        Me.Close()
    End Sub

#End Region

    Private Sub butActivate_ClickButtonArea(Sender As Object, e As MouseEventArgs) Handles butActivate.ClickButtonArea

        ' Dim activateKey As String = calculateActivation(ProductSerialNo, txtActivation1.Text + txtActivation2.Text + txtActivation3.Text + txtActivation4.Text)
        writeKeyFile(txtActivation1.Text + txtActivation2.Text + txtActivation3.Text + txtActivation4.Text)
        RestartElevated()

    End Sub
    Private Sub RestartElevated()

        Dim startInfo As New ProcessStartInfo
        With startInfo
            .UseShellExecute = True
            .CreateNoWindow = True
            .WorkingDirectory = Environment.CurrentDirectory
            .FileName = Application.ExecutablePath
            '.Verb = "runas"
        End With

        Try
            Process.Start(startInfo)
        Catch ex As Exception

        End Try

        Application.Exit()

    End Sub

End Class