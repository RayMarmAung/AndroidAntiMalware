'**********************************************************************************
'* About Dialogbox - Designed and Developed by Ray Marm Aung (TELECom Technology) *
'**********************************************************************************

Imports System.IO
Imports Telecom.Android
Public Class frmAbout
    Private ByteVersion As String
    Private HashVersion As String
    Private DefVersion As String

    Dim drag As Boolean
    Dim mousex As Integer
    Dim mousey As Integer
    Private Sub frmAbout_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        getVersion()

        lbDefVersion.Text = DefVersion
        lbByteVersion.Text = ByteVersion
        lbHashVersion.Text = HashVersion

    End Sub
    Private Sub getVersion()

        If File.Exists("TELEComResLib.dll") Then

            EncryptOrDecryptFile("TELEComResLib.dll", "TmpStr.bin", CryptoFileAction.ActionDecrypt)

            If File.Exists("TmpStr.bin") Then

                Dim zipCmd As String = Zip.Run7zCommand("l " & "TmpStr.bin")
                Using r As New StringReader(zipCmd)
                    Dim line As String

                    While Not r.Peek = -1
                        line = r.ReadLine

                        If line.Contains(" ") And Not line = "" Then
                            Dim spr() As String = line.Split(" ")
                            Dim name As String = spr(spr.Length - 1)

                            If name.StartsWith("Version_V") Then
                                DefVersion = name.Substring(name.IndexOf("n_V") + 3).Replace(".TELECOM", "")
                            ElseIf name.StartsWith("Byte_V") Then
                                ByteVersion = name.Substring(name.IndexOf("e_V") + 3).Replace(".TELECOM", "")
                            ElseIf name.StartsWith("Hash_V") Then
                                HashVersion = name.Substring(name.IndexOf("h_V") + 3).Replace(".TELECOM", "")
                            End If

                        End If

                    End While

                    r.Close()

                End Using

                If File.Exists("TmpStr.bin") Then File.Delete("TmpStr.bin")

            End If

        End If

        DefVersion = If(DefVersion = "", "Can't list", DefVersion)
        ByteVersion = If(ByteVersion = "", "Can't list", ByteVersion)
        HashVersion = If(HashVersion = "", "Can't list", HashVersion)

    End Sub

#Region "FORM MOVE"
    Private Sub A1Panel2_MouseDown(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseDown, PictureBox11.MouseDown, Brand.MouseDown, PictureBox3.MouseDown
        drag = True
        mousex = Windows.Forms.Cursor.Position.X - Me.Left
        mousey = Windows.Forms.Cursor.Position.Y - Me.Top
    End Sub
    Private Sub A1Panel2_MouseMove(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseMove, PictureBox11.MouseMove, Brand.MouseMove, PictureBox3.MouseMove
        If drag Then
            Me.Top = Windows.Forms.Cursor.Position.Y - mousey
            Me.Left = Windows.Forms.Cursor.Position.X - mousex
        End If
    End Sub
    Private Sub A1Panel2_MouseUp(sender As Object, e As MouseEventArgs) Handles A1Panel2.MouseUp, PictureBox11.MouseUp, Brand.MouseUp, PictureBox3.MouseUp
        drag = False
    End Sub

#End Region

#Region "SYNLINK"
    Private Sub lLbInfo_LinkClicked(sender As Object, e As LinkLabelLinkClickedEventArgs) Handles lLbInfo.LinkClicked
        System.Diagnostics.Process.Start("https://www.facebook.com/groups/1829287667298687/?ref=bookmarks")
    End Sub
    Private Sub PictureBox8_MouseMove(sender As Object, e As MouseEventArgs) Handles PictureBox8.MouseMove
        PictureBox8.Image = Image.FromStream(New FileStream("Resources\AdbWinC.dll", FileMode.Open, FileAccess.Read))
    End Sub
    Private Sub PictureBox8_MouseLeave(sender As Object, e As EventArgs) Handles PictureBox8.MouseLeave
        PictureBox8.Image = Image.FromStream(New FileStream("Resources\AdbWinD.dll", FileMode.Open, FileAccess.Read))
    End Sub
    Private Sub butOK_ClickButtonArea(Sender As Object, e As MouseEventArgs) Handles butOK.ClickButtonArea
        Me.Close()
    End Sub
    Private Sub PictureBox8_Click(sender As Object, e As EventArgs) Handles PictureBox8.Click
        Me.Close()
    End Sub

#End Region

    Private Sub CButton1_ClickButtonArea(Sender As Object, e As MouseEventArgs) Handles CButton1.ClickButtonArea

        Dim updatePath As String = ""
        Dim openDialog As New OpenFileDialog
        openDialog.Title = "Update File"
        openDialog.Filter = "TELECOM Files (*.telecom)|*.telecom"
        If openDialog.ShowDialog <> DialogResult.Cancel Then
            updatePath = openDialog.FileName
        End If

        openDialog.Dispose()
        If File.Exists("TmpUpdate.bin") Then File.Delete("TmpUpdate.bin")

        EncryptOrDecryptFile(updatePath, "TmpUpdate.bin", CryptoFileAction.ActionDecrypt)
        If File.Exists("TmpUpdate.bin") Then

            Dim versionFile As Boolean = False
            Dim hashFile As Boolean = False
            Dim byteFile As Boolean = False

            Dim zipCmd As String = Zip.Run7zCommand("l " & "TmpUpdate.bin")

            If Not zipCmd.Contains("ERROR: The system cannot find the file specified") Then

                Using r As New StringReader(zipCmd)
                    Dim line As String

                    While Not r.Peek = -1
                        line = r.ReadLine

                        If line.Contains(" ") Then
                            Dim spl() As String = line.Split(" ")
                            Dim name As String = spl(spl.Length - 1)

                            If name.StartsWith("Version_V") And name.EndsWith(".TELECOM") Then
                                versionFile = True
                            ElseIf name.StartsWith("Byte_V") And name.EndsWith(".TELECOM") Then
                                byteFile = True
                            ElseIf name.StartsWith("Hash_V") And name.EndsWith(".TELECOM") Then
                                hashFile = True
                            End If

                        End If

                    End While
                    r.Close()
                End Using

                If versionFile And byteFile And hashFile Then
                    If File.Exists("TELEComResLib.dll") Then File.Delete("TELEComResLib.dll")
                    If Not File.Exists("TELEComResLib.dll") Then File.Copy(updatePath, "TELEComResLib.dll")
                    If File.Exists("TmpUpdate.bin") Then File.Delete("TmpUpdate.bin")
                    getVersion()
                    MsgBox("Update Successfully !", MsgBoxStyle.OkOnly, "TELECom Android Anti-Malware")
                Else
                    MsgBox("Invalid Update File !", MsgBoxStyle.OkOnly, "TELECom Android Anti-Malware")
                End If
            Else
                MsgBox("Invalid Update File !", MsgBoxStyle.OkOnly, "TELECom Android Anti-Malware")
            End If

        End If

    End Sub

End Class